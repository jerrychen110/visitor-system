(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-104ed152"],{"315c":function(e,r,a){"use strict";var t=a("ed08"),s=a.n(t);s.a},"5b66":function(e,r,a){"use strict";a.r(r);var t=function(){var e=this,r=e.$createElement,a=e._self._c||r;return a("div",[a("el-container",[a("el-header",{staticClass:"header"},[a("h1",[e._v(e._s(this.$route.matched[0].meta.title))]),a("el-button",{staticClass:"header-back-btn",attrs:{type:"primary",size:"mini"},on:{click:function(r){return e.handleJump("/")}}},[e._v("返回首页")]),a("div",{staticClass:"header-user"},[a("el-dropdown",{on:{command:e.handleCommand}},[a("span",{staticClass:"el-dropdown-link"},[a("i",{staticClass:"el-icon-user-solid"}),e._v("\n            "+e._s(e.username)+"\n          ")]),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{command:{url:"UserInfo",name:"编辑信息"}}},[e._v("编辑信息")]),a("el-dropdown-item",{attrs:{command:{url:"Password",name:"修改密码"}}},[e._v("修改密码")])],1)],1)],1)],1),a("el-container",[a("el-aside",{attrs:{width:e.asideWidth}},[a("el-menu",{staticClass:"el-menu-vertical-demo aside",attrs:{"default-active":this.$route.path,router:"",collapse:e.isCollapse}},e._l(e.navList,function(r){return a("el-menu-item",{key:r.index,attrs:{index:r.index}},[a("i",{class:r.icon}),a("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(r.title))])])}),1)],1),a("el-main",{staticClass:"main"},[a("el-row",[a("el-col",{staticClass:"mbl",attrs:{span:24}},[a("el-breadcrumb",{attrs:{separator:"/"}},[a("el-breadcrumb-item",{attrs:{to:{path:"/"}}},[e._v("首页")]),a("el-breadcrumb-item",[e._v("管理平台")]),e._l(e.filterBreadcrumb,function(r){return a("el-breadcrumb-item",{key:r.id},[e._v("\n                "+e._s(r.meta.title)+"\n              ")])})],2)],1)],1),a("router-view")],1)],1)],1),a("dialogs",{attrs:{show:e.dialogVisible,"req-data":e.dialogReqData},on:{"update:show":function(r){e.dialogVisible=r}}})],1)},s=[],o=(a("ac6a"),a("ceb8")),n=a("c702"),i=function(){var e=this,r=e.$createElement,a=e._self._c||r;return a("div",[a("el-dialog",{attrs:{title:e.name,visible:e.visible,show:e.show},on:{"update:visible":function(r){e.visible=r},close:function(r){return e.$emit("update:show",!1)}}},[a(e.url,{tag:"div"})],1)],1)},l=[],m=(a("7f7f"),function(){var e=this,r=e.$createElement,a=e._self._c||r;return a("el-row",[a("el-col",{attrs:{span:24}},[a("el-form",{ref:"form",staticClass:"demo-ruleForm",attrs:{model:e.form,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"用户名"}},[a("el-input",{attrs:{disabled:"disabled"},model:{value:e.form.username,callback:function(r){e.$set(e.form,"username",r)},expression:"form.username"}})],1),a("el-form-item",{attrs:{label:"原密码",prop:"oldPassword",rules:[{required:!0,message:"请输入原密码",trigger:"blur"}]}},[a("el-input",{attrs:{placeholder:"请输入原密码"},model:{value:e.form.oldPassword,callback:function(r){e.$set(e.form,"oldPassword",r)},expression:"form.oldPassword"}})],1),a("el-form-item",{attrs:{label:"新密码",prop:"newPassword",rules:[{required:!0,message:"请输入新密码",trigger:"blur"}]}},[a("el-input",{attrs:{type:e.show.new?"text":"password",placeholder:"请输入新密码"},model:{value:e.form.newPassword,callback:function(r){e.$set(e.form,"newPassword",r)},expression:"form.newPassword"}})],1),a("el-form-item",{attrs:{label:"确认密码",prop:"verifyNewPassword",rules:[{required:!0,message:"请再次输入新密码",trigger:"blur"}]}},[a("el-input",{attrs:{type:e.show.check?"text":"password",placeholder:"请再次输入新密码"},model:{value:e.form.verifyNewPassword,callback:function(r){e.$set(e.form,"verifyNewPassword",r)},expression:"form.verifyNewPassword"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(r){return e.onSubmit("form")}}},[e._v("修改")])],1)],1)],1)],1)}),d=[],u={name:"Password",data:function(){return{form:{username:"",oldPassword:null,newPassword:null,verifyNewPassword:null},show:{old:!1,new:!1,check:!1}}},created:function(){if(sessionStorage.getItem("isLogin")){var e=JSON.parse(sessionStorage.getItem("user"));e.id&&this.getData(e.id)}else{var r=this;r.$message({type:"warning",message:"没有登录!",duration:2e3})}},methods:{getData:function(e){var r=this;axios.get("/API/base-api/user-profile/"+e+"/").then(function(e){var a=e.data;r.form.id=a.id,r.form.username=a.username})},onSubmit:function(e){var r=this;r.$refs[e].validate(function(e){if(e){if(r.form.newPassword!=r.form.verifyNewPassword)return r.$message({message:"新密码与确认密码不一致！",type:"error"}),!1;var a=new FormData;a.append("username",r.form.username),a.append("oldPassword",r.form.oldPassword),a.append("newPassword",r.form.newPassword),axios({url:"/API/base-api/user-profile/"+r.form.id+"/change-password",data:a,method:"put"}).then(function(e){if(console.log(e),300==e.data.results)return r.$message({message:"原密码错误！",type:"error"}),!1;200==e.data.results&&r.$message({message:"修改成功！",type:"success"})})}else{if(null==r.form.oldPassword||""==r.form.oldPassword)return r.$message({message:"原密码必填！",type:"error"}),!1;if(null==r.form.newPassword||""==r.form.newPassword)return r.$message({message:"新密码必填！",type:"error"}),!1;if(null==r.form.verifyNewPassword||""==r.form.verifyNewPassword)return r.$message({message:"确认密码必填！",type:"error"}),!1}})}}},f=u,c=a("2877"),p=Object(c["a"])(f,m,d,!1,null,null,null),w=p.exports,h=function(){var e=this,r=e.$createElement,a=e._self._c||r;return a("el-row",[a("el-col",{attrs:{span:24}},[a("el-form",{ref:"form",staticClass:"demo-ruleForm",attrs:{model:e.form,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"用户名"}},[a("el-input",{attrs:{disabled:"disabled"},model:{value:e.form.username,callback:function(r){e.$set(e.form,"username",r)},expression:"form.username"}})],1),a("el-form-item",{attrs:{label:"用户姓名",prop:"first_name",rules:[{required:!0,message:"请输入用户姓名",trigger:"blur"}]}},[a("el-input",{attrs:{placeholder:"请输入用户姓名"},model:{value:e.form.first_name,callback:function(r){e.$set(e.form,"first_name",r)},expression:"form.first_name"}})],1),a("el-form-item",{attrs:{label:"用户性别",prop:"gender",rules:[{required:!0,message:"请输入用户性别",trigger:"blur"}]}},[a("el-radio-group",{model:{value:e.form.gender,callback:function(r){e.$set(e.form,"gender",r)},expression:"form.gender"}},[a("el-radio",{attrs:{label:1}},[e._v("男")]),a("el-radio",{attrs:{label:2}},[e._v("女")])],1)],1),a("el-form-item",{attrs:{label:"用户邮箱"}},[a("el-input",{attrs:{placeholder:"请输入用户邮箱"},model:{value:e.form.email,callback:function(r){e.$set(e.form,"email",r)},expression:"form.email"}})],1),a("el-form-item",{attrs:{label:"用户描述"}},[a("el-input",{attrs:{type:"textarea",rows:"5",placeholder:"请输入用户描述"},model:{value:e.form.description,callback:function(r){e.$set(e.form,"description",r)},expression:"form.description"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(r){return e.onSubmit("form")}}},[e._v("保存")])],1)],1)],1)],1)},g=[],v={name:"UserInfo",data:function(){return{form:{username:"",first_name:"",last_name:"",password:"",passwordAgain:"",email:"",avatar:[],gender:1,age:0,description:"",is_staff:0,is_active:1,is_superuser:0}}},created:function(){if(sessionStorage.getItem("isLogin")){var e=JSON.parse(sessionStorage.getItem("user"));e.id&&this.getData(e.id)}else{var r=this;r.$message({type:"warning",message:"没有登录!",duration:2e3})}},methods:{getData:function(e){var r=this;axios.get("/API/base-api/user-profile/"+e+"/").then(function(e){var a=e.data;a.avatar?a.avatar=[{name:a.avatar.substring(a.avatar.lastIndexOf("/")+1)}]:a.avatar=[],r.form=a})},resUploadFile:function(e){this.form[e.set.name]=e.value,this.$refs["form"].clearValidate([e.set.name])},onSubmit:function(e){var r=this;r.$refs[e].validate(function(e){if(!e)return!1;var a=new FormData;a.append("username",r.form.username),a.append("first_name",r.form.first_name),a.append("last_name",r.form.last_name),a.append("password",r.form.password),a.append("email",r.form.email),a.append("gender",r.form.gender),a.append("age",r.form.age),a.append("description",r.form.description),a.append("is_staff",r.form.is_staff),a.append("is_active",r.form.is_active),a.append("is_superuser",r.form.is_superuser),axios({url:"/API/base-api/user-profile/"+r.form.id+"/",data:a,method:"put"}).then(function(e){r.$message({message:"修改成功！",type:"success"})})})}}},b=v,_=Object(c["a"])(b,h,g,!1,null,null,null),P=_.exports,x={data:function(){return{visible:this.show,name:null,url:null}},props:{show:{type:Boolean,default:!1},reqData:Object},components:{Password:w,UserInfo:P},watch:{reqData:function(e){this.url=e.url,this.name=e.name},show:function(){this.visible=this.show}}},$=x,y=Object(c["a"])($,i,l,!1,null,null,null),k=y.exports,C={name:"Admin",components:{dialogs:k},data:function(){return{isCollapse:!1,asideWidth:"150px",username:JSON.parse(sessionStorage.getItem("user")).first_name,dialogVisible:!1,dialogReqData:null}},computed:{filterBreadcrumb:function(){var e=[];return this.$route.matched.forEach(function(r,a){r.meta.title&&a&&e.push(r)}),e},navList:function(){var e=this.$store.state.role,r=o["a"].children,a=[];return r.forEach(function(r){var t=r.meta.role;if(!t||t.indexOf(e)>-1){var s={};s.icon=r.meta.icon,s.title=r.meta.title,s.index=o["a"].path+"/"+("/"==r.path?"":r.path+"/"),a.push(s)}}),a}},methods:{handleCommand:function(e){this.dialogReqData=e,this.dialogVisible=!0},handleJump:n["d"],collapse:function(e){console.log(e),this.asideWidth=e?"65px":"150px",console.log(this.asideWidth)}}},I=C,S=(a("315c"),Object(c["a"])(I,t,s,!1,null,"42d00a66",null));r["default"]=S.exports},ed08:function(e,r,a){}}]);
//# sourceMappingURL=chunk-104ed152.cc09633c.js.map